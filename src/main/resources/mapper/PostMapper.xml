<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.rgs.web_demo.mapper.PostMapper">

	<!-- 게시글 상세 조회 -->
	<select id="findById" resultType="com.rgs.web_demo.vo.PostVo">
		SELECT
		id,
		title,
		content,
		post_type AS postType,
		is_secret AS isSecret,
		view_count AS viewCount,
		created_at AS createdAt,
		author_email AS authorEmail
		FROM post
		WHERE id = #{postId}
	</select>

	<!-- 게시글 목록 조회 -->
	<select id="selectPostList" resultType="com.rgs.web_demo.vo.PostVo"> SELECT
		id, title, content, post_type AS postType, is_secret AS isSecret,
		view_count AS viewCount, created_at AS createdAt, author_email AS
		authorEmail FROM post <where>
			<if test="keyword != null and keyword != ''">
				AND (title LIKE CONCAT('%', #{keyword}, '%')
				OR content LIKE CONCAT('%', #{keyword}, '%'))
			</if>
		</where>
		ORDER BY created_at DESC LIMIT #{size} OFFSET #{offset} </select>

	<!-- 게시글 개수 조회 -->
	<select id="countPostList" resultType="long"> SELECT COUNT(*) FROM post <where>
			<if test="keyword != null and keyword != ''">
				AND (title LIKE CONCAT('%', #{keyword}, '%')
				OR content LIKE CONCAT('%', #{keyword}, '%'))
			</if>
		</where>
	</select>

	<!-- 게시글 등록 -->
	<insert id="insertPost"
		parameterType="com.rgs.web_demo.dto.request.PostCreateRequest">
		INSERT INTO post (
		title,
		content,
		author_email,
		post_type,
		is_secret,
		created_at,
		updated_at
		) VALUES (
		#{title},
		#{content},
		#{authorEmail},
		#{postType},
		#{isSecret},
		CURRENT_TIMESTAMP,
		CURRENT_TIMESTAMP
		)
	</insert>


	<!-- 게시글 삭제 -->
	<delete id="deletePostById">
		DELETE FROM post WHERE author_email = #{authorEmail}
	</delete>

</mapper>
